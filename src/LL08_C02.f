c ------------------------------------------------------------------
C *** Adjusted Lin and Lee (2008) Horizontal for Subduction Zones, ****
c ------------------------------------------------------------------

      subroutine LL08_C02 ( mag, rupdist, specT, period, lnY, sigma,
     1  iflag, Ztor, ftype, vs30)

      implicit none

      integer MAXPER, nPer, i
      parameter (MAXPER=23)
      real mag, rupDist, lnY, sigma, period
      real ftype, vs30, Ztor, eq1, eq2
      real c1(MAXPER), c2(MAXPER), c3(MAXPER), c6(MAXPER), 
     1     c8(MAXPER), c9(MAXPER), c10(MAXPER), c11(MAXPER)
      real specT, c1T, c2T, c3T, c4, c5, c6T, c7, c8T, c9T, c10T, c11T, sigT
      integer count1, count2, iflag
      real period1(MAXPER), sig(MAXPER), tau(MAXPER)

      Data period1 / 0, 0.01, 0.02, 0.03, 0.04, 0.05, 0.075, 0.1, 0.12, 0.15, 0.17, 0.2, 0.25, 0.3, 0.4, 0.5, 0.75, 1, 1.5, 2, 3,
     1      4, 5/
      Data c1 / -3.33670321385538, -3.37692964623083, -3.40438419221068, -3.13887395393085, -2.82763443110634, -2.75607637513273,
     1      -2.35621759029331, -2.09446746265678, -2.34146936192363, -2.43299402446881, -2.53137708621466, -2.68521949993661,
     1      -3.11864738937753, -3.81246642479948, -4.46456500352872, -5.10978208777496, -5.95573514924221, -7.30343053949017,
     1      -8.48268270261319, -9.41663403353582, -10.8394113583283, -12.0257707104069, -12.5399302360413/
      Data c2 / 1.205, 1.205, 1.2, 1.155, 1.1, 1.09, 1.04023471290541, 1, 1.04, 1.045, 1.065, 1.085, 1.12512345582376, 1.215,
     1      1.285, 1.365, 1.465, 1.62, 1.705, 1.77, 1.83, 1.845, 1.805/
      Data c3 / -1.905, -1.895, -1.88, -1.875, -1.86, -1.855, -1.82624150716967, -1.795, -1.77, -1.73, -1.71, -1.675,
     1      -1.61902356955068, -1.57, -1.5, -1.465, -1.45, -1.45, -1.44, -1.43, -1.37, -1.26, -1.135/
      Data c6 / 0.017141931513954, 0.0171547284601399, 0.0173244670778763, 0.0181862751529862, 0.0189179712344036,
     1      0.0197258664790822, 0.0197960210948023, 0.0209778099866708, 0.0212052934947672, 0.0209689342349369, 0.0202666928408263,
     1      0.0193067830561315, 0.0168419245272157, 0.0145706812324631, 0.0125994775491599, 0.0116690750440869,
     1      0.00684680066232507, 0.00394066922414578, -0.000689068259963991, -0.00296999985571239, -0.00752210093668873,
     1      -0.00584580955427855, -0.0088062001901245/
      Data c8 / 0.0255654752697277, 0.026325681563805, 0.0281588013855082, 0.0179572327374023, 0.0122209632916528,
     1      0.0217186792749382, 0.0309679769748329, 0.0289651163363396, 0.0346892334009609, 0.0227945541237408, 0.0168290202377704,
     1      0.00142976503095002, -0.0020615496734386, 0.000898362034478657, -0.0343484026641479, -0.0591491933222577,
     1      -0.103217246399724, -0.0969738537016994, -0.11206611955039, -0.108869343596765, -0.0763487844646969,
     1      -0.066916102844068, -0.0196254535988319/
      Data c9 / 0.0377801164936114, 0.0378453490435329, 0.0392883634896706, 0.0442070740060219, 0.0481364269751726,
     1      0.0522453278806752, 0.0480520271922752, 0.0479843051215394, 0.0481490861134022, 0.0453585407522508, 0.042930963456279,
     1      0.04110871356441, 0.03811805235926, 0.0338439069722297, 0.0278213077417252, 0.0232189881337878, 0.0143712148562772,
     1      0.0121650008271784, 0.00520775900963053, -3.67644237584643e-05, -0.0073632681879128, 0.00379499214156005,
     1      -0.019870523115892/
      Data c10 / -0.000906537183795324, -0.000969204868891609, -0.00105709538072226, -0.00108473184998276, -0.00104621601869672,
     1      -0.000958198857484448, -0.000861788560406518, -0.00128725266931769, -0.00192618722339361, -0.00229017995786029,
     1      -0.00289980007517345, -0.00343036473478919, -0.00326446266395986, -0.00351151514588161, -0.00459963855608011,
     1      -0.00544262709007372, -0.00524880080430356, -0.00456278874395173, -0.00259839586675441, -0.00212923370803201,
     1      -0.000146331375108611, -0.000666969403367026, -0.00159772155678309/
      Data c11 / -0.353195019628294, -0.351918539088056, -0.341533044134863, -0.310457836554322, -0.251823916725673,
     1      -0.189432463493244, -0.119431321723877, -0.147374459931071, -0.204816497533918, -0.285222597513701, -0.325580916097784,
     1      -0.357837850765548, -0.406910424570984, -0.458145616359641, -0.588227825519244, -0.666202756763859, -0.822406559742613,
     1      -0.913630029200771, -0.908432988901663, -0.885678799246322, -0.843623718809591, -0.757676641668781, -0.700329850168376/
      Data tau / 0.448657651103196, 0.447877387114587, 0.44554139279591, 0.447290077543133, 0.448087793638351, 0.450588557400074,
     1      0.465003793517578, 0.475097188328951, 0.480776197804072, 0.474334856998635, 0.475392785911858, 0.470185522510387,
     1      0.481055635690822, 0.486429563553991, 0.486110503382779, 0.485713260537601, 0.477331226654766, 0.483968147594935,
     1      0.466127811875156, 0.478981652033781, 0.466602391149214, 0.495899262019139, 0.404524974292644/
      Data sig / 0.487878114283778, 0.487796971544415, 0.48733057616774, 0.490603706515884, 0.503610061319261, 0.524705006919523,
     1      0.546543305056914, 0.538754225165176, 0.532617863503442, 0.52023594697735, 0.527868310941621, 0.52757705218841,
     1      0.524114444057946, 0.524414415388233, 0.533154049076781, 0.537056579696166, 0.525262350061849, 0.51379368768783,
     1      0.523339576636261, 0.540101064232156, 0.526816408626179, 0.494349896621824, 0.446944954496643/


C Find the requested spectral period and corresponding coefficients
      nPer = 23

C First check for the PGA case (i.e., specT=0.0)
      if (specT .eq. 0.0) then
         period  = period1(1)
         c1T     = c1(1)
         c2T     = c2(1)
         c3T     = c3(1)
         c6T     = c6(1)
         c8T     = c8(1)
         c9T     = c9(1)
         c10T    = c10(1)
         c11T    = c11(1)
         sigT    = sig(1)
         goto 1011
      elseif (specT .ne. 0.0) then
C Now loop over the spectral period range of the attenuation relationship.
         do i=2,nper-1
            if (specT .ge. period1(i) .and. specT .le. period1(i+1) ) then
               count1 = i
               count2 = i+1
               goto 1020
            endif
         enddo
      endif

C      write (*,*)
C      write (*,*) 'Lin and Lee (2008) Sub-Hor. Adjusted atttenuation model'
C      write (*,*) 'is not defined for a spectral period of: '
C      write (*,*)') ' Period = ',specT
C      write (*,*) 'This spectral period is outside the defined'
C      write (*,*) 'period range in the code or beyond the range'
C      write (*,*) 'of spectral periods for interpolation.'
C      write (*,*) 'Please check the input file.'
C      write (*,*)
      stop 99

C Interpolate the coefficients for the requested spectral period.
 1020 call interp (period1(count1),period1(count2),c1(count1),c1(count2),
     +             specT,c1T,iflag)
      call interp (period1(count1),period1(count2),c2(count1),c2(count2),
     +             specT,c2T,iflag)
      call interp (period1(count1),period1(count2),c3(count1),c3(count2),
     +             specT,c3T,iflag)
      call interp (period1(count1),period1(count2),c6(count1),c6(count2),
     +             specT,c6T,iflag)
      call interp (period1(count1),period1(count2),c8(count1),c8(count2),
     +             specT,c8T,iflag)
      call interp (period1(count1),period1(count2),c9(count1),c9(count2),
     +             specT,c9T,iflag)
      call interp (period1(count1),period1(count2),c10(count1),c10(count2),
     +             specT,c10T,iflag)
      call interp (period1(count1),period1(count2),c11(count1),c11(count2),
     +             specT,c11T,iflag)
      call interp (period1(count1),period1(count2),sig(count1),sig(count2),
     +             specT,sigT,iflag)

 1011 period = specT

C     Compute the ground motions.
      c4 = 0.51552
      c5 = 0.63255
      c7 = 0.275
      
      if (mag .lt. 7.2) then
      	eq1 = c8T*(mag - 7.2)**2.0
      else
        eq1 = 0
      endif
      
      if (ftype .eq. 0) then
      	eq2 = c9T*(max(Ztor, 30.0) - 20.0)
      else
        eq2 = c6T*(max(Ztor, 80.0) - 20.0)
      endif
      
      lnY = c1T + c2T*mag + eq1 + c3T*alog(Rupdist+c4*exp(c5*mag)) + 
     1      c7*ftype + eq2 + c10T*Rupdist + c11T*alog(Vs30/760.0)


      sigma = sigT

C     Now convert to Ln Units in gals.
      lnY = lnY + 6.89

      return
      end